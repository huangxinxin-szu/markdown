[TOC]



## 接口规范

### 返回错误码为0

错误码为0是因为业务接口返回的error类型不是

## 日志规范

### 给每个请求打上标记

请求之间常常夹杂很多其他请求的日志，区分哪些日志是属于这个请求的很麻烦，特别是在请求耗时比较的时候：

```shell
admin-kn2@kn2:/usr/local/work/nfs/starlight/logs$ cat user-2020-03.log | grep 4ba23d78-7503-4ecc-a3ea-0ce3e4c3d833 -A 10
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:08 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：4ba23d78-7503-4ecc-a3ea-0ce3e4c3d833，请求方法：GET，处理函数：GetSelfUser，来源IP：172.16.100.254，用户：cuiyingyan,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:25 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：bfc52c0d-2921-4514-b1ba-5414f6a63f68，请求方法：GET，处理函数：GetSelfUser，来源IP：223.74.55.201，用户：jnu_xhjiang_1,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:27 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：1d2ffeb7-e195-4ca3-bfd7-263e0fc18664，请求方法：GET，处理函数：GetSelfUser，来源IP：223.74.55.201，用户：jnu_xhjiang_1,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:30 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：1a4a11fb-02a5-4ff6-8a1b-0e922f35ea7c，请求方法：GET，处理函数：GetSelfUser，来源IP：172.16.100.254，用户：cuiyingyan,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:31 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：521f837b-0f57-4934-8d9b-73200bfda63d，请求方法：GET，处理函数：GetSelfUser，来源IP：223.74.55.201，用户：jnu_xhjiang_1,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:34 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user_verify/password_check，标识：5b144d80-f504-4fd0-8b49-9748ebd79187，请求方法：GET，处理函数：CheckUserBihuPasswordByName，来源IP：112.96.36.194，用户：nscc-gz_kangyouzhong,请求数据：
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:34 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/user_profile，标识：505ac9a5-cd47-4dec-910f-ac7040325865，请求方法：GET，处理函数：GetUserProfile，来源IP：112.96.36.194，用户：nscc-gz_kangyouzhong,请求数据：???
INFO[26 Mar 20 09:22 CST] 2020/03/26 09:22:34 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：033fd2c6-af31-4449-916f-f777796b214d，请求方法：GET，处理函数：GetSelfUser，来源IP：172.16.100.254，用户：cuiyingyan,请求数据：
INFO[26 Mar 20 09:23 CST] 2020/03/26 09:23:01 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/self，标识：213add29-4eff-4357-bd33-43949867b1a1，请求方法：GET，处理函数：GetSelfUser，来源IP：223.74.55.201，用户：jnu_xhjiang_1,请求数据：
INFO[26 Mar 20 09:23 CST] 2020/03/26 09:23:03 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/user/user_profile，标识：adf38d3f-a8cb-40f2-bd9b-a7f883cea18c，请求方法：GET，处理函数：GetUserProfile，来源IP：172.16.100.254，用户：cuiyingyan,请求数据：???
INFO[26 Mar 20 09:23 CST] 2020/03/26 09:23:03 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:322: 接收访问请求：/status，标识：d9f59481-34f5-4dfe-a651-ea33059ced19，请求方法：GET，处理函数：GetUserStatus，来源IP：172.16.100.254，用户：cuiyingyan,请求数据：???
--
INFO[26 Mar 20 09:23 CST] 2020/03/26 09:23:44 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:412: 响应访问请求：/user/self，标识：4ba23d78-7503-4ecc-a3ea-0ce3e4c3d833，请求方法：GET，处理函数：GetSelfUser，来源IP：172.16.100.254，用户：cuiyingyan，请求数据：，请求结果：{{4ba23d78-7503-4ecc-a3ea-0ce3e4c3d833 1110 处理超时，请联系管理员进行处理  0} <nil>}，耗时：96.372563s，错误信息：
已过截止时间
error stack:
starlight/common/metric.Process /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:514
starlight/user.ms/api.GetSelfUser /var/jenkins_home/workspace/pro/src/starlight/user.ms/api/query.go:56
```



用户名为???

请求数据没有的话就不用打印“请求数据:”了



一个请求日志示例

```shell
INFO[23 Mar 20 18:06 CST] 2020/03/23 18:06:49 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:292: 接收访问请求：/app?page=1&limit=24&order_by=id&field_eq_app__published=1，标识：08c973d3-73d8-4dc3-ab37-8fdd77672c6f，请求方法：GET，处理函数：GetApps，来源IP：61.152.133.242，用户：huaqin_llfan_1,请求数据：
INFO[23 Mar 20 18:06 CST] 2020/03/23 18:06:49 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:382: 响应访问请求：/app?page=1&limit=24&order_by=id&field_eq_app__published=1，标识：08c973d3-73d8-4dc3-ab37-8fdd77672c6f，请求方法：GET，处理函数：GetApps，来源IP：61.152.133.242，用户：huaqin_llfan_1，请求数据：，请求结果：{{08c973d3-73d8-4dc3-ab37-8fdd77672c6f 0 no valid transaction  0} <nil>}，耗时：0.001721s，错误信息：
```



### 可优化的日志

#### 很长的路径

如下日志，代码路径的前缀没必要：

```shell
2020/03/25 15:24:18 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:323: 接收访问请求：/acorn/19d611cb-7185-4b05-946a-f0c937ff2e26，标识：02ab5cf8-b5c8-4264-9c4d-eb77a800b954，请求方法：GET，处理函数：GetSingleAcorn，来源IP：120.230.41.48，用户：???,请求数据：???
```

可改成：

```shell
2020/03/25 15:24:18 common/metric/metric.go:323: req: /acorn/19d611cb-7185-4b05-946a-f0c937ff2e26，id: 02ab5cf8，请求方法：GET，处理函数：GetSingleAcorn，IP: 120.230.41.48，用户：???,请求数据：???
```

2^32=43亿，1天才30w行日志

#### 很长的请求结果

```shell
INFO[23 Mar 20 17:54 CST] 2020/03/23 17:54:37 /var/jenkins_home/workspace/pro/src/starlight/common/metric/metric.go:382: 响应访问请求：/app/abaqus-f2
，标识：f156a2f5-0035-446b-b888-4a63cfe4c79a，请求方法：GET，处理函数：GetSpecStarApp，来源IP：58.63.128.230，用户：gziit_dfzq_1，请求数据：，请求结果：{{f1
56a2f5-0035-446b-b888-4a63cfe4c79a 200  star applications 1} {345 abaqus-f2 Abaqus  8aeef47d-4ffd-4bd4-8a9f-675b1b82101e Abaqus is a software suite for fini
te element analysis and computer-aided engineering. 0 []  []  [123 34 105 100 34 58 34 119 105 100 103 101 116 115 45 114 111 111 116 34 44 34 116 121 112 1
01 34 58 34 99 111 110 116 97 105 110 101 114 34 44 34 110 97 109 101 34 58 34 34 44 34 118 97 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 4
8 44 34 119 105 100 116 104 34 58 50 52 44 34 108 97 98 101 108 34 58 34 230 160 185 231 187 132 228 187 182 34 44 34 97 116 116 114 34 58 123 125 44 34 100
 97 116 97 34 58 91 123 34 105 100 34 58 34 105 110 102 111 49 34 44 34 116 121 112 101 34 58 34 105 110 102 111 34 44 34 110 97 109 101 34 58 34 34 44 34 1
18 97 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 104 34 58 50 52 44 34 108 97 98 101 108 34 58 34 34 44 34 97 116
116 114 34 58 123 34 100 101 102 97 117 108 116 34 58 34 60 104 49 62 60 115 116 114 111 110 103 62 230 172 162 232 191 142 228 189 191 231 148 168 65 66 65
 81 85 83 230 177 130 232 167 163 229 153 168 46 60 47 115 116 114 111 110 103 62 60 47 104 49 62 92 110 60 100 105 118 62 60 115 116 114 111 110 103 62 38
110 98 115 112 59 60 47 115 116 114 111 110 103 62 60 47 100 105 118 62 92 110 60 112 62 60 115 116 114 111 110 103 62 230 179 168 230 132 143 228 186 139 2
33 161 185 58 38 110 98 115 112 59 60 47 115 116 114 111 110 103 62 60 115 116 114 111 110 103 62 32 40 49 41 32 230 128 187 230 160 184 230 149 176 228 184
 141 229 143 175 228 187 165 232 182 133 232 191 135 232 138 130 231 130 185 230 149 176 42 50 52 239 188 140 229 144 166 229 136 153 228 189 156 228 184 15
4 229 164 177 232 180 165 227 128 130 60 47 115 116 114 111 110 103 62 60 47 112 62 92 110 60 112 62 60 115 116 114 111 110 103 62 38 110 98 115 112 59 32 3
8 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115
 112 59 32 60 115 116 114 111 110 103 32 115 116 121 108 101 61 92 34 98 111 120 45 115 105 122 105 110 103 58 32 105 110 104 101 114 105 116 59 32 102 111
110 116 45 119 101 105 103 104 116 58 32 98 111 108 100 101 114 59 32 99 111 108 111 114 58 32 35 51 48 51 49 51 51 59 32 102 111 110 116 45 102 97 109 105
108 121 58 32 39 72 101 108 118 101 116 105 99 97 32 78 101 117 101 39 44 32 72 101 108 118 101 116 105 99 97 44 32 39 80 105 110 103 70 97 110 103 32 83 67
 39 44 32 39 72 105 114 97 103 105 110 111 32 83 97 110 115 32 71 66 39 44 32 39 77 105 99 114 111 115 111 102 116 32 89 97 72 101 105 39 44 32 65 114 105 9
7 108 44 32 115 97 110 115 45 115 101 114 105 102 59 32 102 111 110 116 45 115 105 122 101 58 32 49 52 112 120 59 32 102 111 110 116 45 115 116 121 108 101
58 32 110 111 114 109 97 108 59 32 102 111 110 116 45 118 97 114 105 97 110 116 45 108 105 103 97 116 117 114 101 115 58 32 110 111 114 109 97 108 59 32 102
 111 110 116 45 118 97 114 105 97 110 116 45 99 97 112 115 58 32 110 111 114 109 97 108 59 32 108 101 116 116 101 114 45 115 112 97 99 105 110 103 58 32 110
 111 114 109 97 108 59 32 111 114 112 104 97 110 115 58 32 50 59 32 116 101 120 116 45 97 108 105 103 110 58 32 115 116 97 114 116 59 32 116 101 120 116 45
105 110 100 101 110 116 58 32 48 112 120 59 32 116 101 120 116 45 116 114 97 110 115 102 111 114 109 58 32 110 111 110 101 59 32 119 104 105 116 101 45 115
112 97 99 101 58 32 110 111 114 109 97 108 59 32 119 105 100 111 119 115 58 32 50 59 32 119 111 114 100 45 115 112 97 99 105 110 103 58 32 48 112 120 59 32
45 119 101 98 107 105 116 45 116 101 120 116 45 115 116 114 111 107 101 45 119 105 100 116 104 58 32 48 112 120 59 32 98 97 99 107 103 114 111 117 110 100 4
5 99 111 108 111 114 58 32 35 102 102 102 102 102 102 59 32 116 101 120 116 45 100 101 99 111 114 97 116 105 111 110 45 115 116 121 108 101 58 32 105 110 10
5 116 105 97 108 59 32 116 101 120 116 45 100 101 99 111 114 97 116 105 111 110 45 99 111 108 111 114 58 32 105 110 105 116 105 97 108 59 92 34 62 40 50 41
32 228 189 156 228 184 154 231 154 132 232 190 147 229 135 186 230 150 135 228 187 182 228 188 154 229 146 140 232 190 147 229 133 165 230 150 135 228 187 1
82 229 156 168 229 144 140 228 184 128 231 155 174 229 189 149 228 184 139 239 188 140 229 187 186 232 174 174 231 148 168 230 136 183 228 184 186 230 175 1
43 228 184 128 228 184 170 228 189 156 228 184 154 229 187 186 231 171 139 229 141 149 231 139 172 231 154 132 230 150 135 228 187 182 229 164 185 239 188 1
40 228 187 165 233 129 191 229 133 141 230 150 135 228 187 182 232 166 134 231 155 150 227 128 130 60 47 115 116 114 111 110 103 62 60 47 115 116 114 111 11
0 103 62 60 47 112 62 92 110 60 112 62 60 115 116 114 111 110 103 62 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 1
12 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 38 110 98 115 112 59 32 40 51 41 232 139 165 233 156 128 232 166 129 229 173 1
44 231 168 139 229 186 143 239 188 140 232 175 183 229 156 168 232 135 170 229 174 154 228 185 137 233 128 137 233 161 185 228 184 173 229 138 160 229 133 1
65 38 108 100 113 117 111 59 117 115 101 114 61 229 173 144 231 168 139 229 186 143 229 144 141 38 114 100 113 117 111 59 232 191 155 232 161 140 228 189 19
1 231 148 168 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 32 38 110 98 115 112 59 38 110 98 115 112 59 6
0 47 115 116 114 111 110 103 62 60 47 112 62 34 44 34 118 105 115 105 98 108 101 34 58 116 114 117 101 125 44 34 100 97 116 97 34 58 91 93 125 44 123 34 105
 100 34 58 34 108 105 115 116 49 34 44 34 116 121 112 101 34 58 34 108 105 115 116 34 44 34 110 97 109 101 34 58 34 86 69 82 83 73 79 78 34 44 34 118 97 108
 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 104 34 58 50 52 44 34 108 97 98 101 108 34 58 34 230 177 130 232 167 163 2
29 153 168 231 137 136 230 156 172 34 44 34 97 116 116 114 34 58 123 34 114 101 113 117 105 114 101 100 34 58 116 114 117 101 44 34 100 105 115 97 98 108 10
1 100 34 58 102 97 108 115 101 44 34 118 105 115 105 98 108 101 34 58 116 114 117 101 44 34 111 112 116 105 111 110 115 34 58 91 123 34 108 97 98 101 108 34
 58 34 54 46 49 52 46 49 34 44 34 118 97 108 117 101 34 58 34 65 66 65 81 85 83 95 54 95 49 52 95 49 34 44 34 110 117 109 98 101 114 34 58 102 97 108 115 10
1 44 34 100 105 115 97 98 108 101 100 34 58 102 97 108 115 101 44 34 115 101 108 101 99 116 101 100 34 58 102 97 108 115 101 125 44 123 34 108 97 98 101 108
 34 58 34 54 46 49 51 46 52 34 44 34 118 97 108 117 101 34 58 34 65 66 65 81 85 83 95 54 95 49 51 95 52 34 44 34 100 105 115 97 98 108 101 100 34 58 102 97
108 115 101 125 44 123 34 108 97 98 101 108 34 58 34 54 46 49 50 46 51 34 44 34 118 97 108 117 101 34 58 34 65 66 65 81 85 83 95 54 95 49 50 95 51 34 44 34
100 105 115 97 98 108 101 100 34 58 102 97 108 115 101 125 44 123 34 108 97 98 101 108 34 58 34 50 48 49 55 34 44 34 118 97 108 117 101 34 58 34 65 66 65 81
 85 83 95 50 48 49 55 34 44 34 100 105 115 97 98 108 101 100 34 58 102 97 108 115 101 125 93 44 34 100 101 102 97 117 108 116 34 58 34 65 66 65 81 85 83 95
54 95 49 52 95 49 34 125 44 34 100 97 116 97 34 58 91 93 125 44 123 34 105 100 34 58 34 114 102 98 49 34 44 34 116 121 112 101 34 58 34 114 102 98 34 44 34
110 97 109 101 34 58 34 73 78 80 85 84 95 70 73 76 69 34 44 34 118 97 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 1
04 34 58 50 52 44 34 108 97 98 101 108 34 58 34 232 190 147 229 133 165 230 150 135 228 187 182 91 42 46 105 110 112 93 34 44 34 97 116 116 114 34 58 123 34
 112 108 97 99 101 104 111 108 100 101 114 34 58 34 34 44 34 100 101 102 97 117 108 116 34 58 34 34 44 34 118 105 115 105 98 108 101 34 58 116 114 117 101 4
4 34 114 101 113 117 105 114 101 100 34 58 116 114 117 101 44 34 114 117 108 101 115 34 58 34 34 125 44 34 100 97 116 97 34 58 91 93 125 44 123 34 105 100 3
4 58 34 116 101 120 116 49 34 44 34 116 121 112 101 34 58 34 116 101 120 116 34 44 34 110 97 109 101 34 58 34 69 88 84 82 65 95 79 80 84 73 79 78 83 34 44 3
4 118 97 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 104 34 58 50 52 44 34 108 97 98 101 108 34 58 34 232 135 170 2
29 174 154 228 185 137 233 128 137 233 161 185 34 44 34 97 116 116 114 34 58 123 34 112 108 97 99 101 104 111 108 100 101 114 34 58 34 34 44 34 114 101 113
117 105 114 101 100 34 58 102 97 108 115 101 44 34 100 105 115 97 98 108 101 100 34 58 102 97 108 115 101 44 34 118 105 115 105 98 108 101 34 58 116 114 117
 101 44 34 114 117 108 101 115 34 58 34 34 44 34 100 101 102 97 117 108 116 34 58 34 32 115 99 114 97 116 99 104 61 47 100 101 118 47 115 104 109 34 125 44
34 100 97 116 97 34 58 91 93 125 44 123 34 105 100 34 58 34 114 102 98 80 97 116 104 49 34 44 34 116 121 112 101 34 58 34 114 102 98 80 97 116 104 34 44 34
110 97 109 101 34 58 34 70 95 67 79 68 69 34 44 34 118 97 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 104 34 58 50
52 44 34 108 97 98 101 108 34 58 34 231 148 168 230 136 183 232 135 170 229 174 154 228 185 137 231 168 139 229 186 143 34 44 34 97 116 116 114 34 58 123 34
 112 108 97 99 101 104 111 108 100 101 114 34 58 34 34 44 34 100 101 102 97 117 108 116 34 58 34 34 44 34 118 105 115 105 98 108 101 34 58 116 114 117 101 4
4 34 114 101 113 117 105 114 101 100 34 58 102 97 108 115 101 44 34 114 117 108 101 115 34 58 34 34 125 44 34 100 97 116 97 34 58 91 93 125 44 123 34 105 10
0 34 58 34 110 117 109 98 101 114 49 34 44 34 116 121 112 101 34 58 34 110 117 109 98 101 114 34 44 34 110 97 109 101 34 58 34 67 79 82 69 83 34 44 34 118 9
7 108 117 101 34 58 34 34 44 34 111 102 102 115 101 116 34 58 48 44 34 119 105 100 116 104 34 58 50 52 44 34 108 97 98 101 108 34 58 34 230 128 187 230 160
184 230 149 176 34 44 34 97 116 116 114 34 58 123 34 109 105 110 34 58 34 49 34 44 34 109 97 120 34 58 34 49 48 48 48 34 44 34 115 116 101 112 34 58 34 49 3
4 44 34 100 101 102 97 117 108 116 34 58 34 49 34 44 34 112 108 97 99 101 104 111 108 100 101 114 34 58 34 34 44 34 114 101 113 117 105 114 101 100 34 58 11
6 114 117 101 44 34 100 105 115 97 98 108 101 100 34 58 102 97 108 115 101 44 34 118 105 115 105 98 108 101 34 58 116 114 117 101 44 34 114 117 108 101 115
34 58 34 34 125 44 34 100 97 116 97 34 58 91 93 125 93 125] 1 #!/usr/bin/env cwl-runner

```



