

[toc]



## 连接k8s

```go
package main

import (
	"fmt"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/tools/clientcmd"
)

func main() {
	k8sConfig, err := clientcmd.BuildConfigFromFlags("", "k8s_cluster.config")
	if err != nil {
		fmt.Printf("%v",err)
		return
	}

	clientSet, err := kubernetes.NewForConfig(k8sConfig)
	if err != nil {
		fmt.Printf("%v",err)
		return
	}

	nodes, err := clientSet.CoreV1().Nodes().List(metav1.ListOptions{})
	if err != nil {
		fmt.Printf("%v",err)
		return
	}
	
	for _,node := range nodes.Items {
		fmt.Println(node.Name)
	}
}
```

yam配置：

```yaml
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01ERXhOakEzTVRBME5sb1hEVE13TURFeE16QTNNVEEwTmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTGpwClcrdzBoN3lRTkJacnNVUDJyUlBraVlCMW5KYkJYV2RRUkxaVnZtNlRtSC9ORnloWm9zeDFhQStnU2pQWDdtMWQKZCtDblFVNURmTDZHMGMwa1VRZFRBbEtIbWF3Z0ZVTm82cFNmeERTRHNPKzBMazd4d0V5c3pjQVdveFBiSzlrMApBUkt2OVI0SGwrRHBNWVJwZHJRSTlWTjFodVFveTg0ZnlRVUVmSlM1emRoeGQ3N09BbTJ1MzQrQmZ6SHNML0ZSCmhqRU5FNUZ4SFRCVExRRWNYOTVpMHAwT012SDNYS2RDU0p0TFRnVDNmVDJjUGw4cXZmYzBCaHFnbXFZc2tENWkKYWZlRTJzUjVHMFFNeG93RjJXbHpYOUtUc2krbGJwVDFkbG5xeVZYOWVrRVlBTm5LYWZPTlI2c1ZKbGp2VG8xeApYSEZVbDBrakEvNm43TWRNc2dVQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEMEIzWVNOcm1OZy9uclNiTTExeHZ2VzZ4NmEKZE45LzVIUjRHMHZjMDRDWUlJUjNaODg0YWZkRWVFTjZENzdGdWlPMDhWaXRCZzJLRjdremx2MG5kYWVkenIvcQppMC9FeEM2QUpGK2d2cG5PVmdnWGxhRm5uN2F3YncwRGNCSHhubldQbXl1Lzdsa3o4V1ptVXR1dC9SblF3b2pjCkR1RUtwYzhoM1RDM1ArSWNkVW1DcUpwek54Q21SLzdhejQyZ3BlMm1zRUVyOUFVaXNDdTNYTk5GSHd0Nkpha0EKK1VmbWxib0wvS1NxY3hMeUVjbmpPM1I4RkQ0bkhQQmFTZTROL1hDUDJHOTN0bjdnZ3JPYnBqSDE4R0ZvbThCMAo2UkVBMms4MCtDNmloTW9LSUFTU082R3dqNDRjY0c0M3ltSC9oaWtSd1ZpbTVlMWZZRkVudHVINWQ1Zz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    server: https://10.222.111.16:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJR08rYm5QQS9UOHd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TURBeE1UWXdOekV3TkRaYUZ3MHlNVEF4TVRVd056RXdOVEZhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTNyOFdVSnZCNGtUL0xLbkkKNEwvWWVqMUJGcGJOR1Jwc0x6REZYZy9IS09IcEpaUEhSWkZHSWVUOUcraTVjUDdDMG5ENVVlRFRYSW8vQTAyYQpTdzBQVkpsL0tmRk9kK1JmQjh2SWdjOUJ6d1VmR1V3K0NLTW9UUnhBNHNxSnVGRGd0NUsxYUxtcDZLOUo5d1dBCkh6WmhOREFzRnpJM3hoV0JrdTdVaktBMWJQV0FOeDdmeVpiT2UvRVBSOU4wMVduS0tYRk5aYkZpVFFrbjh6anMKR0owQklHbjlTZll1Tk9xaHlOeUk3ampPWXM0RTczdVN5M2wzb0VjcmtzMGwrcml6dFNxNWhBZStERHVqTDkzbwo3SEdnakpWV2xUakFJaHBHWWZwUzJFQ0RNdUsyZ1h0UklGbExiQUsxTWprSjNjTWFJdW9EMFhUYVFCam1Ydzd4ClE0Qmtkd0lEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFCWDNXRFEzSDJhZ1dNNzhUdUJYcVJ5cmdCUDFkUW5BRkpNNwpMZHZrd2QvQ3JzeHFyMVJLYnQrQXdvUjdGSXp0cFk3ODdpR096bGUycmtrTkRyY0dpR3picDZBbzJSL09vS05YCitjQVRIdGNnNHVLSmxLcmdEcUpTeTJXNnVTSkdXMDQyQ1Z0VlJwWlBMdVRvUVhqblFKdThQeVA5dm9FalFMeEgKaDVvVmVaRndjQ2JQYkhUUVI1bncrVXVBT2R3a3pMUUZZYWh4UjRmK09OQTNSQWVUczhGZ3FQeTdLOXN6UWdwdwprbjkwZ0xxSUtkNFpXU1VpRjg3MTB5eDNpZnZhNGk2UGd6SWEzdGw3VGhpS0orcFBMYTdBRnhzWWlKUWp1blVhCmhRVVI0dlBEZWNoNTFSZ1kzUGRpRU5QaW5QTis3SmpPRnF4QUNYU2k3Q1NVaUhsand1MD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBM3I4V1VKdkI0a1QvTEtuSTRML1llajFCRnBiTkdScHNMekRGWGcvSEtPSHBKWlBIClJaRkdJZVQ5RytpNWNQN0MwbkQ1VWVEVFhJby9BMDJhU3cwUFZKbC9LZkZPZCtSZkI4dklnYzlCendVZkdVdysKQ0tNb1RSeEE0c3FKdUZEZ3Q1SzFhTG1wNks5Sjl3V0FIelpoTkRBc0Z6STN4aFdCa3U3VWpLQTFiUFdBTng3Zgp5WmJPZS9FUFI5TjAxV25LS1hGTlpiRmlUUWtuOHpqc0dKMEJJR245U2ZZdU5PcWh5TnlJN2pqT1lzNEU3M3VTCnkzbDNvRWNya3MwbCtyaXp0U3E1aEFlK0REdWpMOTNvN0hHZ2pKVldsVGpBSWhwR1lmcFMyRUNETXVLMmdYdFIKSUZsTGJBSzFNamtKM2NNYUl1b0QwWFRhUUJqbVh3N3hRNEJrZHdJREFRQUJBb0lCQUErZTd2MndMcVNqbWhHVAp4cGFjWFo0VTlaK1Q2OFk2NkNOWEZFQkljdnNXL0xhNTZsdWltSHlBQnBBU2ZnN0NqdjhiRlNEODExWENEREU3CkcvcnZhNGZQUysreEVJT3Y3RW9yckdBT0hOdGJ6SmFGbGtRY3pSSzdUSUdiR3BWbWRwdnBHZmZDTFh3MzdzUDQKQ3NnbGxDT0l6VTdESXM0dGErelYrdW54d2sxbHVKck1BRFVDRVF6dDREdnJ6bHNjdis1Y2JYYnNERWNPOFdCUAo0eUJseW1Yc2lySDhpdEFLUmdPYk5ZNXljYkJPY3FqUHpVZjBxVnlIVDdpNzFmWmRISE1DR3lFb2Zlbmpic0ZzCjltN2dEakFKNFBNSnJuL2Frd09veUVYcm5jMHI4bi9ta1NERHRtS2hxb2xjUkxHRzAzdHhzYXJZS2lFQmJ3eHgKYVFWUVFxRUNnWUVBNkhLTTVNWnFENUVIcnVadTZBdnFZL1ZPREVvTklYVVRieVdxQ1BrOUNJUHAzVTZEcHI4aApwa1BrRmtHQkdLbm96WG0yaUxWak0yQ29rdlVWSnB2c3FaRDdFYWQ4emlQVFErUWFrV2xJR2E2Mmk2NmtrYmZhClhnTkVVOXRIQVhtZjZlWWpIRVVpNDNYUG9jWVFhZzdrdUdCK1RWSGlacm1HLzFOS3FLaE9zTFVDZ1lFQTlWRG0KN0hsYk1tS2R5QnMxTUdKajB6UWVJN3Y1b1pieDZQaEVEbzJjYXV6RXRxMjdWMDFsdUpMd1hMOXUySXlNMGxsVwpNS1VFbDRLbFJDdmtMMStFWFFSbjU5akdzeXhKbHZMaGJaUXQ3SFdZVlB5MmFFSVYzRy9neHlNVWV6ZndLR2p1CmluTWQ4ZmY2cEV4ZFVHUHpST1E0b1JSTlZBdWJldUhhdElPQmQvc0NnWUJjM3FkOEgrbndIam03bjBWZ1lLSmQKSFh6NVcveXpDVnVpWktIeXcrR21yVTJhcGV2aml5bWVqREZzMHU4Sk01bFh2dkUyM1lHczNVbDhyWDZ0MWs1UAowU1QrZ0xSVWgrdTRqRUl4SnFjdjI2WURXTnRYZk9VNStvUXFITW5aeFFZbkpWT1J6KzJJZzJGWmVSREZ6djJDCnpNcXBpYld5NVIwU2xleVdSZWhxb1FLQmdCT3NrVmlWd3dLZmRoZitWcDJ5eGw3QjUwam1ZbmJiTER1SzdhcGQKSVJaU050U1B5bDZPRG9KbkJtL3B5bklEazZlckVvYUVOWUlSTUQvdlpUV0hhNDRxTkVzYno1Ty9FWWZSb3RLdQo5NS9uTG5oaWJCNmdiakJucUpkUDhPeVE1K25Wd0l2Si83VFFOb0hHdmhVY2J2NHZiM3M3clpmMzlsZzhsTlcxClZrVFJBb0dCQUtPRjFnRFl3bDJXODNndjM5U2YrbDdlS1hsLzJVV2psbUdwdHV4V3VOTllxOVVLTnZ4OWVQQVIKTlp6dGFIaURjV2lrS3gwMHN1Y2RsME82SHR3MFZPWmhmMjFSQ0FpeFlPTGRkSjJsMkVwQUdNU3NkMXRvNEZDZwoyNHBjR2M4dGhCOXdMdC8yVC9qU21BRVF1a1NYdGJELzFtbjJjSk13S2ZNTkM1MStCNVhsCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
```

## 常用操作

```go
// 查询node列表
nodes, err := clientSet.CoreV1().Nodes().List(metav1.ListOptions{})

// 运行一个deployment
deploy, err = client.AppsV1().Deployments(d.Namespace).Create(targetDeploy)

// 运行一个批处理作业
jobcreated, err = client.BatchV1().Jobs(d.Namespace).Create(targetJob)
// 删除job
clientSet.BatchV1().Jobs(namespace).Delete(name, &metav1.DeleteOptions{PropagationPolicy: &propagationPolicy}) // propagationPolicy := metav1.DeletePropagationBackground
// 查询
clientSet.BatchV1().Jobs(namespace).Get(name, metav1.GetOptions{})
```

